# 源码查看总结

往往从你拿到一份源码的时候是非常懵逼的，没有官方文档的话看起来会特别费力，需要从入口一点点的去深入，但往往这样看下去会迷失在各种设计模式当中，可能大概知道点功能的实现方向，而对大体的架构说不清道不明，时间一久基本上都忘得差不多了，这个时候我们需要有一个惯用的阅读习惯来总结每次看源码得到的心得体会。

## 从大到小

首先进行模块的划分，你需要知道这个框架的分层，比如它分了很多的项目，每个项目是做什么的？

拿RocketMQ举例:

rocketmq

- acl 
- broker : 消息存储服务端
- client : 客户端接入
- common : 公共模块，类似工具类等等 
- distribution : 编译打包
- docs : 文档
- example : 案例
- filter : 过滤器
- logappender : 日志组件
- logging  :  也是日志组件
- namesrv : 注册中心
- openmessaging : 消息协议
- remoting : 远程通信组件
- srvutil : 服务端工具类
- store : 存储组件

从上面我们知道它一共划分了这么多模块，其中最重要的：注册中心、消息存储服务端以及客户端接入。

知道每个模块的作用，这个时候我们可以还需要知道一个整体流程。

## 了解主线流程

其实通俗一点来讲就是从客户端到服务端数据怎么传输的，注册中心是起了什么作用？这些模块是怎么串起来。

知道这些至少你对整个框架或者中间件有了一个大概的认识：比如消息队列：

1. 客户端启动的时候需要注册到注册中心当中去。
2. 服务端注册的时候也需要注册到注册中心去。
3. 这时候客户端发消息可以从注册中心得到服务端地址，得到了服务端地址然后通过Netty将数据发送到服务端中。
4. 服务端又会对消息进行很多处理完之后得到topic、key、内容等等，将消息存储到指定队列中。
5. 客户端的消费者会固定监听服务端端的几个队列，如果这个队列中有消息进入了，客户端立马监听到并且消费。
6. 消费完成之后一个消息的大体流程就已经执行完毕了

这个时候如果能够自己画点图出来就更完美了，以后复习的时候可能会用得上

## 了解功能场景的实现

知道了主线流程之后已经对这个东西有了一个大体的认识了，至少出了问题能知道大概的排查方向。

这个时候我们需要了解一下更细节的消息处理过程中的一些规则了，比如

**客户端**

- 消息如何编解码发送？
- 消息发送和消费失败，如何处理？
- ...

**服务端**

- 消息怎么过滤?
- 消息如何存放?
- 消费失败如何处理?
- 各类型的消息如何处理?
- ...

**注册中心**

- 各端失败了，如何处理？
- 各端如何通讯?

....



如果能够画图出来，对知识回顾也很有帮助。

## 简易版的实现

如果上面的思路全部了解了，那么已经有了一个很全面的认识了，这个时候千万不要就此打住了，你应该把主体思路通过代码在再实现一遍。这个时候遇到不会的再参考参考，稍微细节的可以不用纠结，毕竟一个大的框架一时半会也弄不出来，一定要把最精髓的部分搞明白写出来。这时候自己也可以多拓展补充一下，这对以后改造源码也提供了很多的助力。

