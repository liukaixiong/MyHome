# 压测优化方案手段

## 服务

1. ### 查看日志框架是否是异步插入

```xml
<appender name="ASYNC_FILE" class="ch.qos.logback.classic.AsyncAppender">
    <discardingThreshold>0</discardingThreshold>
    <queueSize>10000</queueSize>
    <appender-ref ref="cat"/>
    <neverBlock>true</neverBlock>
</appender>
```

如果是同步插入的话，在数据量比较大的情况下耗时比较严重。

异步： 50W ： 7s

同步：50W  ： 30s

### 2. 查看业务中是否需要异步处理的业务进行抽离

例如短信、优惠券，总的来说就是不需要返回值的统统改成异步操作。

### 3. 查看当前应用的线程数是否成为瓶颈

例如查看tomcat的最大并发数和线程数是否可以进行有效调整，接口的请求是否可以做成异步化。

### 4. 是否需要考虑引用消息队列来解耦业务实现异步化

和第二点差不多。

### 5. 考虑线程隔离

主要是为了避免一个服务出现大量流量将线程占用完了，其他服务会受到影响。

### 6. 快速失败

为了避免请求的接口耗时比较严重，而且并发比较高的情况下，会拖垮整个服务的并发以及线程数占用。

### 7. 文件IO操作使用buffer。

减少内核级调用、减少IO操作、可能减少CPU指令

### 8. 数据结构指定大小

减少扩容带来的内存占用及复制和老数据回收代理的CPU指令。

### 9. jvm调优步骤

根据gc日志计算出应用长期存活对象（老年代、永久代）的大小。

权衡合理的GC算法。











## 数据库

### 1. 首先确认大表是否有索引

这点是非常关键的，索引能够快速定位到数据。

### 2. SQL表关联是否合理，尽量将一些复杂的SQL交给业务服务去做

数据库的资源比较稀缺，尽量把复杂的操作让业务服务去处理

### 3. 查看业务中是否有统计、报表等大的表操作进行分表

通过定时任务将大的表进行汇总成一张新的表，做一些新的数据报表。

### 1. 是否有必要引入缓存来降低业务服务的压力和数据库的压力。

例如有些需要调用第三方的接口的操作，如天气、手机归属地等等。















